

{% load custom_filters %}


<div class="d-grid cont-grid-122 cont-grid-products">
    <!-- Primera Fila 	-->
    <h2 class="bold-main"> Tus Productos </h2>

    <button class="btn gap-1 btn-main py-1 px-2 w-max justify-self-end" id="add-new-product">
        <i class="ri-function-add-line font-lg"></i>
        <span class="font-md"><b>Agregar Producto</b></span>
    </button>

    <!-- Segunda Fila 	-->
    <form class="btn-40 search-dashboard" id="search-dashboard">
        <input type="text" name="query" placeholder="Buscar producto...">
        <i class="ri-search-line font-lg"></i>
    </form>

    <div class="d-flex justify-self-end gap-1">
        <div class="btn btn-border btn-40 px-1 w-min relative" id="btn-filter" aria-expanded="false">
            <p class="font-md">Filtros</p>
            <i class="ri-filter-2-line font-lg"></i>

            <!-- Menu desplegable de filtros -->
            <form class="dropdown-generic border-main" data-state="null" 
            id="form-select-filters" data-table="table-products">

                <!-- Disponibilidad select -->
                <label class="d-flex-col gap-1">
                    <strong class="text-start">Disponibilidad:</strong>

                    <select class="text-truncate" name="available">
                        <option value="1">Disponible</option>
                        <option value="0">No Disponible</option>
                        <option value="2">Todos</option>
                    </select>
                </label>

                <!-- Categorias y subcategorias select -->
                <label class="d-flex-col mt-1 gap-1">
                    <strong class="text-start">Categoría:</strong>
                
                    <select class="category-select text-truncate" name="category">
                        <option value="0">Seleccione una categoría</option>
                        <option value="1">Sin Categoría</option>
                        {% for category, subcategories in categories.items %}
                            <option value="{{category.id}}">
                                {{ category.name }}
                            </option>
                        {% endfor %}
                    </select>
                </label>
            
                <!-- Campo oculto que enviará la subcategoría seleccionada -->
                <input type="hidden" name="subcategory" class="selected-subcategory" value="0">

                {% for category, subcategories in categories.items %}
                    {% if forloop.first %}
                        <div class="subcat-container mt-1 subcat-cont-0" data-state="closed">
                            <label class="d-flex-col gap-1">
                                <strong class="text-start">Subcategoría:</strong>

                                <select class="subcat-select text-truncate">
                                    <option value="0">Seleccione una subcategoría</option>
                                    <option value="1">Sin Sub-Categoría</option>
                                </select>
                            </label>
                        </div>
                    {% endif %}

                    {% if subcategories %}
                        <div class="subcat-container mt-1 subcat-cont-{{category.id}}" data-state="closed">

                            <label class="d-flex-col gap-1">
                                <strong class="text-start">Subcategoría:</strong>

                                <select class="subcat-select text-truncate">
                                    <option value="0">Seleccione una subcategoría</option>
                                    {% for subcat in subcategories %}
                                        <option value="{{subcat.id}}">
                                            {{subcat.name}}
                                        </option>
                                    {% endfor %}
                                </select>
                            </label>
                        </div>
                    {% endif %}
                {% endfor %}

                <button class="btn justify-self-center btn-main w-50 p-1 mt-2" type="submit">
                    <strong class="font-md">Aplicar</strong>
                </button>
            </form>
        </div>

        <!--   Reset Filters Mobile	 -->
        <form class="d-mobile-block form-reset-filters" data-table="table-products">
            <input type="hidden" name="available" value="2">
            
            <button type="submit" class="btn btn-border btn-40 w-min px-1">
                <i class="ri-close-fill font-lg"></i>
                <p class="font-md">Filtros</p>
            </button>
        </form>

        <div class="d-desktop-flex gap-1">
            <button class="btn btn-border btn-40 px-1 active-main">
                <i class="ri-list-check-2 font-lg"></i>
            </button>
    
            <button class="btn btn-border btn-40 px-1">
                <i class="ri-layout-grid-fill font-lg"></i>
            </button>
        </div>
    </div>

    <!-- Tercera Fila 	-->
    <div class="d-desktop-flex grid-col-all cont-space-between">
        <p class="font-sm">
            <b> Filtros Aplicados: </b>
            <span id="resume-filters">Ninguno</span>
        </p>

        <!--   Reset Filters		 -->
        <form class="form-reset-filters" data-table="table-products">
            <input type="hidden" name="available" value="2">
            
            <button type="submit" class="btn btn-border btn-40 w-min px-1">
                <i class="ri-close-fill font-lg"></i>
                <p class="font-md">Filtros</p>
            </button>
        </form>
    </div>
</div>

<!-- 	TABLE PRODUCTSSSSS	 -->
<div class="d-grid grid-products border-primary not-border-bottom font-sm mt-2">
    <div class="d-flex py-1">
        <strong class="ms-1">Productos</strong>
        <button class="btn btn-sorted text-primary" data-sort-by="name" data-sorted="null">
            <b><i class="ri-arrow-up-down-line font-md"></i></b>
        </button>
    </div>

    <div class="d-desktop-flex align-center py-1">
        <strong>Categorías</strong>
        <button class="btn btn-sorted text-primary" data-sort-by="category__name" data-sorted="null">
            <b><i class="ri-arrow-up-down-line font-md"></i></b>
        </button>
    </div>

    <div class="d-desktop-flex justify-center align-center py-1">
        <strong>Disponible</strong>
        <button class="btn btn-sorted text-primary" data-sort-by="available" data-sorted="null">
            <b><i class="ri-arrow-up-down-line font-md"></i></b>
        </button>
    </div>

    <div class="d-desktop-flex justify-end align-center py-1">
        <strong>Ventas</strong>
        <button class="btn btn-sorted text-primary" data-sort-by="sales" data-sorted="null">
            <b><i class="ri-arrow-up-down-line font-md"></i></b>
        </button>
    </div>

    <div class="d-desktop-flex justify-end align-center py-1">
        <strong class="text-truncate">Fecha Act.</strong>
        <button class="btn btn-sorted text-primary" data-sort-by="updated_at" data-sorted="null">
            <b><i class="ri-arrow-up-down-line font-md"></i></b>
        </button>
    </div>

    <div class="d-desktop-flex justify-end align-center py-1">
        <strong>Stock</strong>
        <button class="btn btn-sorted text-primary" data-sort-by="stock" data-sorted="null">
            <b><i class="ri-arrow-up-down-line font-md"></i></b>
        </button>
    </div>

    <div class="d-desktop-flex justify-end align-center py-1 me-1">
        <strong>Precio</strong>
        <button class="btn btn-sorted text-primary" data-sort-by="price" data-sorted="null">
            <b><i class="ri-arrow-up-down-line font-md"></i></b>
        </button>
    </div>
</div>

<!-- Add main content here -->
<section class="border-primary" id="table-products">
    {% include "dashboard/table_products.html" %}
</section>








<!-- Form to add new product  -->
<form class="modal form-modal" id="form-modal-product">

    <template id="template-add-product">
        <p><strong>Especificaciones técnicas:</strong></p>
        <p>● Listado 1</p>
        <p>● Listado 2 <strong>(*)</strong></p>
        <p>• Listado 3</p>
        <p>&nbsp;</p>
        <p><strong>(*)</strong> Auxiliar Listado 2</p>
        <p>Comentario</p>
    </template>

    <div class="d-flex-col gap-2">

        <!--   TITULO FORMULARIO 		 -->
        <div class="cont-space-between">
            <strong class="font-lg bold-main text-truncate modal-title"> </strong>

            <button type="button" class="btn btn-32 btn-close form-modal-close"> 
                <i class="ri-close-fill font-xl"></i>
            </button>   
        </div>

        <!--   FILA 1 FORMULARIO 		 -->
        <div class="d-grid row-modal-product">
            <label class="d-flex-col gap-1 name">
                <strong>Nombre:</strong>
                <input type="text" class="modal-name" name="name"/>
            </label>
                
            <label class="d-flex-col gap-1 available">
                <strong class="text-truncate">Disponible:</strong>
                <div class="d-flex w-100 ms-2">
                    <input type="checkbox" class="modal-available" name="available"/>
                </div>
            </label>
        
            <label class="d-flex-col gap-1 price">
                <strong>Precio:</strong>
                <input type="text" class="modal-price" name="price"/>
            </label>
        
            <label class="d-flex-col gap-1 discount">
                <strong class="text-truncate">Descuento (%):</strong>
                <input type="text" class="modal-discount" name="discount"/>
            </label>
        
            <label class="d-flex-col gap-1 subtotal">
                <strong>SubTotal:</strong>
                <input type="text" class="modal-subtotal"/>
            </label>
        
            <label class="d-flex-col gap-1 stock">
                <strong>Stock:</strong>
                <input type="text" class="modal-stock" name="stock"/>
            </label>
        </div>

        <!--   FILA 2 FORMULARIO 	SELECTS	 -->
        <div class="d-grid cont-grid-234 p-0">

            <!-- Categorias select -->
            <label class="d-flex-col gap-1">
                <strong>Categoría:</strong>

                <select class="category-select modal-category" name="category">
                    <option value="0">Sin Categoría</option>
                    {% for category, subcategories in categories.items %}
                        <option value="{{ category.id }}">
                            {% if subcategories %}
                                ➤
                            {% endif %}
                            {{ category.name }}
                        </option>
                    {% endfor %}
                </select>
            </label>
            
            <!-- subcategorias select -->
            <div class="d-flex-col gap-1">

                <!-- Campo oculto que enviará la subcategoría seleccionada -->
                <input type="hidden" name="subcategory" class="selected-subcategory" value="0">

                {% for category, subcategories in categories.items %}

                    {% if forloop.first %}
                        <label class="subcat-container gap-1 subcat-cont-0" data-state="closed">
                            <strong>Subcategoría:</strong>
                            <select class="subcat-select">
                                <option value="0">Sin Subcategoría</option>
                            </select>
                        </label>
                    {% endif %}

                    {% if subcategories %}
                        <label class="subcat-container gap-1 subcat-cont-{{category.id}}" data-state="closed">
                            <strong>Subcategoría:</strong>
                            <select class="subcat-select modal-subcategory-{{category.id}}">
                                <option value="0">Sin Subcategoría</option>
                                {% for subcat in subcategories %}
                                    <option value="{{subcat.id}}">
                                        {{ subcat.name }}
                                    </option>
                                {% endfor %}
                            </select>
                        </label>
                    {% endif %}
                {% endfor %}
            </div>

            <!-- BRANDS -->
            <label class="d-flex-col gap-1">
                <strong>Marca:</strong>
                
                <select class="brand-select modal-brand" name="brand">
                    <option value="0">Sin Marca</option>
                    {% for brand in brands %}
                        <option value="{{ brand.id }}">
                            {{ brand.name }}
                        </option>
                    {% endfor %}
                </select>
            </label>
        </div>

        <!--   FILA 3 Cont-Images	 -->
        <div class="cont-block-update" data-state="closed">
            <div class="d-flex gap-1"> 
                <strong>Imagenes del Producto</strong>
                <i class="ri-corner-right-down-line font-lg"></i> 
            </div>

            <div class="d-grid cont-grid-234 cont-modal-images">    </div>
        </div>
        
        <!--   FILA 4 y 5 FORMULARIO 		 -->
        <div class="d-grid cont-grid-122 align-stretch border-top-prim p-0 py-2">

            <!--   FILA 4: Product Description		 -->
            <div class="d-flex-col gap-1">
                <strong>Descripción del Producto: (*)</strong>
                <textarea class="font-md h-170 p-1 modal-description" name="description">   </textarea>
            </div>

            <div class="d-flex-col gap-1">
                <strong>Vista Previa de la Descripción:</strong>
                <div class="h-170 border-main p-1 font-md scroll-y description-preview "></div>
            </div>

            <strong class="grid-col-all">(*) Simbolos:</strong>
            <div class="grid-col-all cont-space-between p-2 border-hover"> 
                <span>** Negrita **</span>
                <span>-- Linea en blanco</span>
                <span>* listado</span>
                <span>*- listado</span>
                <span>(*) auxiliar</span>
            </div>

            <!--   FILA 5: Images previews		 -->
            <div class="d-flex-col gap-1">
                <div class="d-flex gap-1">
                    <strong> Nueva Imagen Preview </strong>
                    <i class="ri-corner-right-down-line font-lg"></i> 
                </div>

                <!-- Contenedor para las previsualizaciones -->
                <div class="border-main d-grid cont-grid-234 gap-1 cont-img-100 cont-img-previews">  </div>
            </div>

            <!-- 	Apply changes and submit images 	 -->
            <div class="d-flex-col">
                <!-- Añade multiple y name como array <input type="file" class="image-input" name="images"> -->
                <input type="file" class="image-input" name="images" multiple>
                <!-- 	<input type="file" class="image-input" name="images" multiple accept="image/*" capture="camera">	 -->
        
                <div class="d-flex-col-row justify-center align-center gap-2 mt-2 mb-1">
                    <button class="btn gap-1 btn-main btn-36 w-100" type="submit" value="update"> 
                        <i class="ri-edit-2-line font-lg"></i>
                        <b>Aplicar Cambios</b>
                    </button>

                    <button class="btn btn-close btn-36 w-100 form-modal-cancel" type="button">
                        <b>Cancelar</b>
                    </button>
                </div>

                <p class="font-md"><b>(*)</b> Recorda siempre mirar bien las imagenes subidas y/o eliminadas...</p>
                <p class="font-md"><b>(**)</b> Si cancelas perderás los cambios realizados...</p>
            </div>
        </div>

    </div>
</form>
