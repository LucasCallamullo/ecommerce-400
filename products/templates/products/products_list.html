{% extends "home/base.html" %}
{% load static %}


<!-- For More CSS Modules -->
{% block extra_head %}

    
    <link href="{% static 'products/css/products_cards.css' %}" rel="stylesheet">
    <link href="{% static 'products/css/products_list.css' %}" rel="stylesheet">

    <title> {{store.name}} | {% if category %}{{ category.name }}{% endif %}  </title>
    
    
{% endblock %}


<!-- Contenido principal de la pagina -->
{% block main_content %}

<div class="d-flex w-100 mb-3 gap-1">
    <a class="btn btn-parallelogram d-lg-block" href="{% url 'product_list' %}">
        <span> Todos Nuestros Productos </span>
    </a>
    
    {% if category %}
        <a class="btn btn-parallelogram" href="{% url 'pl_category' category.slug %}">
            <span>{{ category.name }}</span>
        </a>
    {% endif %}

    {% if subcategory %}
        <a class="btn btn-parallelogram" href="{% url 'pl_subcategory' category.slug subcategory.slug %}">
            <span>{{ subcategory.name }}</span>
        </a>
    {% endif %}

    {% if query %}
        <button class="btn btn-parallelogram">
            <span class="font-md">Resultados de la busqueda: '{{ query }}'</span>
        </button>
    {% endif %}
</div>

<!-- This is for use in a dataForm to send -->
<div class="d-none" id="filters">
    <input type="hidden" name="category" value="{% if category %}{{ category.id|default:'' }}{% else %}{% endif %}">
    <input type="hidden" name="subcategory" value="{% if subcategory %}{{ subcategory.id|default:'' }}{% else %}{% endif %}">
    <input type="hidden" name="lastQuery" value="{% if query %}{{ query|default:'' }}{% else %}{% endif %}">
    <input type="hidden" name="available" value="{{ available|default:1 }}">
    <input type="hidden" name="page" value="1">
</div>


<div class="d-grid gap-2 h-min cont-grid-11-13">
    
    <aside class="d-desktop-flex d-flex-col gap-2">
        <!-- TOP 10 BUTTON SIDE -->
        <button class="btn btn-main btn-48 w-100 gap-2 bolder font-md">
            <i class="ri-star-fill"></i>TOP 10
        </button>

        <!-- Sidebar -->
        <div class="mt-3 border-hover bg-primary p-2">
            <h2 class="text-start mt-1"> Filtros </h2>

            <form class="d-flex btn-40 w-100 mb-2 mt-2" id="sidebar-search">
                <input type="input" name='query' placeholder="Buscar productos...">
            </form>
    
            <!-- Categories will be inserted here -->
            <ul class="d-flex-col">
                <li class="d-flex justify-start">
                    <a class="btn btn-28 w-100 btn-primary justify-start" href="{% url 'product_list' %}">
                        <strong>Todas las Categorias</strong>
                    </a>
                </li>
        
                {% for cat, sub_cats in categories_dropmenu.items %}
                <li class="d-flex-col align-start">
                    <a class="btn btn-28 w-100 btn-primary justify-start" href="{% url 'pl_category' cat.slug %}">
                        <strong>{{ cat.name }}</strong>
                    </a>
                    
                    <!-- Submenú with SubCategories -->
                    {% if sub_cats %}
                        <ul class="d-flex-col">
                            {% for sub_cat in sub_cats %}
                                <li class="d-flex ms-3">
                                    <a class="btn btn-28 w-100 btn-primary justify-start" 
                                    href="{% url 'pl_subcategory' cat.slug sub_cat.slug %}">
                                        {{ sub_cat.name }}
                                    </a>
                                </li>
                            {% endfor %}
                        </ul>
                    {% endif %}
                </li>

                {% endfor %}
            </ul>
            
            <!-- More content ? ¡ -->
            <div class="d-flex-col mt-2 gap-2" id="cont-brands">
                
            </div>
            
        </div>
    </aside>

    <!-- Main Content -->
    <div class="d-grid cont-grid-234 h-min gap-2" id="cont-product-cards">
        
    </div>

    <div class="grid-start-col-2 mt-2 justify-self-center d-flex gap-2" id="cont-pagination"
        data-total-pages="{{ pagination.total_pages }}" data-page-num="{{ pagination.page }}">
    </div>
</div>




{% include "products/components/card__modal.html" %}

{% endblock main_content %}


{% block extra_scripts %}
    <!-- JavaScript for Product Page -->
    <script>
        window.TEMPLATE_URLS = {
            // favorites/urls.py
            favorites: "{% url 'toggle-favorite' 0 %}".replace('0/', '{product_id}/'),
            
            // products/urls.py
            addToCart: "{% url 'cart_add_product' %}",
            productDetail: "{% url 'product_detail' id=0 slug='__SLUG__' %}",
            category: "{% url 'pl_category' cat_slug='__CAT__' %}",
            subcategory: "{% url 'pl_subcategory' cat_slug='__CAT__' subcat_slug='__SUBCAT__' %}",
            brand: "{% url 'pl_brand' brand_slug='__BRAND__' %}",

            // products/urls_api.py
            productList: "{% url 'product-update-api' 0 %}".replace('/0/', '{product_id}'),
            productImages: "{% url 'product-images-api' 0 %}".replace('/0/', '/{product_id}/')
        };
    </script>

    
    <script src="{% static 'products/js/components/cards_products.js' %}"></script>
    <script src="{% static 'favorites/js/add_favorites.js' %}"></script>
    <script src="{% static 'products/js/products_cards.js' %}"></script>
    
    <script src="{% static 'products/js/product_list.js' %}"></script>

    <script>
        window.ProductStore.setData(JSON.parse('{{ productos_json|escapejs }}'));
    </script>

{% endblock extra_scripts %}

